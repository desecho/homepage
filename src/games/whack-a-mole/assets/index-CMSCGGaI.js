(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const N=.09,G=.006,D=1e-4,k=.2,F=860,W=620;function Y(){const t=globalThis;return t.AudioContext??t.webkitAudioContext??null}function q(){let t=null,e=!1,n=!1,s=!1;const i=()=>{if(n||e)return null;if(t&&t.state!=="closed")return t;const l=Y();if(!l)return e=!0,null;try{return t=new l,t}catch{return e=!0,null}},r=l=>{l.state==="suspended"&&l.resume().catch(()=>{})};return{prime:()=>{if(s)return;const l=i();l&&r(l)},playHit:()=>{if(s)return;const l=i();if(!l)return;r(l);const h=l.currentTime,m=h+N,M=l.createOscillator(),u=l.createGain();M.type="triangle",M.frequency.setValueAtTime(F,h),M.frequency.exponentialRampToValueAtTime(W,m),u.gain.setValueAtTime(D,h),u.gain.exponentialRampToValueAtTime(k,h+G),u.gain.exponentialRampToValueAtTime(D,m),M.connect(u),u.connect(l.destination),M.onended=()=>{M.disconnect(),u.disconnect()},M.start(h),M.stop(m)},destroy:()=>{if(n||(n=!0,!t))return;const l=t;t=null,l.close().catch(()=>{})},setMuted:l=>{s=l},isMuted:()=>s}}const H={roundDurationMs:6e4,boardRows:3,boardCols:3,hitHideDurationMs:120,timeoutHideDurationMs:220,difficultyStepMs:1e4,baseVisibleDurationMs:1150,minVisibleDurationMs:480,visibleDurationStepMs:115,baseSpawnDelayMinMs:460,baseSpawnDelayMaxMs:920,minSpawnDelayMinMs:180,minSpawnDelayMaxMs:370,spawnDelayMinStepMs:36,spawnDelayMaxStepMs:55},U=-.34,V=1.62;function $(t){return Math.max(0,Math.min(1,t))}function X(t){return t*t}function z(t,e){return t.state!=="hiding"||t.hideStartedAtMs===null?0:t.hideDurationMs<=0?1:$((e-t.hideStartedAtMs)/t.hideDurationMs)}function C(t,e,n){const s=z(e,n),i=X(s)*t.radius*V;return{x:t.center.x,y:t.center.y+t.radius*U+i}}function K(t,e){const n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}function Q(t,e,n,s,i=.72){const r=new Map(n.map(a=>[a.id,a]));for(let a=e.length-1;a>=0;a-=1){const o=e[a],d=r.get(o.holeId);if(!d)continue;const p=C(d,o,s),S=d.radius*i,l=t.x-p.x,h=t.y-p.y;if(l*l+h*h<=S*S)return o.id}return null}function A(t,e,n=Math.random){const s=Math.ceil(Math.min(t,e)),i=Math.floor(Math.max(t,e));return s===i?s:Math.floor(n()*(i-s+1))+s}function Z(t,e=Math.random){return A(t.spawnDelayMinMs,t.spawnDelayMaxMs,e)}const j=.19,J=.035;function x(t,e){const n=t.getBoundingClientRect(),s=Math.max(1,Math.floor(n.width)),i=Math.max(1,Math.floor(n.height)),r=typeof window>"u"?1:window.devicePixelRatio||1,a=Math.max(1,Math.floor(s*r)),o=Math.max(1,Math.floor(i*r));return(t.width!==a||t.height!==o)&&(t.width=a,t.height=o),e.setTransform(r,0,0,r,0,0),{width:s,height:i}}function tt(t,e,n,s){const i=Math.max(90,Math.floor(e*j)),r=Math.max(16,Math.floor(Math.min(t,e)*J)),a=r,o=t-r,d=i+r*.5,p=e-r,S=o-a,l=p-d,h=S/s,m=l/n,M=Math.min(h,m)*.33,u=[];for(let f=0;f<n;f+=1)for(let c=0;c<s;c+=1)u.push({id:f*s+c,center:{x:a+h*(c+.5),y:d+m*(f+.56)},radius:M});return u}function et(t,e,n){const s=t.createLinearGradient(0,0,0,n);s.addColorStop(0,"#f5df9c"),s.addColorStop(1,"#b7d986"),t.fillStyle=s,t.fillRect(0,0,e,n),t.fillStyle="rgba(255, 255, 255, 0.22)",t.beginPath(),t.arc(e*.16,n*.2,e*.2,0,Math.PI*2),t.arc(e*.83,n*.12,e*.13,0,Math.PI*2),t.fill()}function it(t,e,n){t.fillStyle="rgba(38, 46, 31, 0.2)",t.fillRect(0,0,e,82);const i=Math.max(0,Math.ceil(n.timeLeftMs/1e3));t.fillStyle="#162318",t.font="700 23px 'Trebuchet MS', 'Gill Sans', sans-serif",t.textBaseline="middle",t.fillText(`Score ${n.score}`,18,82/2),t.fillText(`Time ${i}s`,e/2-56,82/2),t.fillText(`Best ${n.bestScore}`,e-150,82/2)}function nt(t,e){t.fillStyle="#5d3417",t.beginPath(),t.ellipse(e.center.x,e.center.y+e.radius*.2,e.radius*1.05,e.radius*.52,0,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(33, 16, 6, 0.45)",t.lineWidth=4,t.stroke()}function st(t,e,n,s){const i=e.radius*.78,r=C(e,n,s),a=r.x,o=r.y,d=Math.max(1.5,e.radius*.055);t.save();const p=e.center.y-e.radius*2.2,S=e.center.y+e.radius*.3;t.beginPath(),t.rect(a-e.radius*1.6,p,e.radius*3.2,S-p),t.clip();const l=t.createRadialGradient(a-i*.28,o-i*.4,i*.2,a,o+i*.25,i*1.08);l.addColorStop(0,"#af7b4f"),l.addColorStop(.55,"#825131"),l.addColorStop(1,"#5b341f");for(const u of[-1,1]){const f=a+u*i*.47,c=o-i*.52;t.fillStyle="#6c3f26",t.beginPath(),t.ellipse(f,c,i*.25,i*.22,u*.28,0,Math.PI*2),t.fill(),t.fillStyle="#d9a692",t.beginPath(),t.ellipse(f+u*i*.03,c+i*.01,i*.13,i*.11,u*.24,0,Math.PI*2),t.fill()}t.fillStyle=l,t.beginPath(),t.arc(a,o,i,0,Math.PI*2),t.fill(),t.fillStyle="rgba(182, 125, 84, 0.3)",t.beginPath(),t.ellipse(a,o+i*.2,i*.72,i*.5,0,0,Math.PI*2),t.fill(),t.fillStyle="#e8c7ad",t.beginPath(),t.ellipse(a,o+i*.25,i*.48,i*.35,0,0,Math.PI*2),t.fill(),t.fillStyle="rgba(98, 63, 42, 0.2)",t.beginPath(),t.ellipse(a,o+i*.31,i*.39,i*.18,0,0,Math.PI*2),t.fill(),t.fillStyle="#523028",t.beginPath(),t.ellipse(a,o+i*.13,i*.18,i*.12,0,0,Math.PI*2),t.fill(),t.strokeStyle="#2f1712",t.lineWidth=Math.max(1.1,d*.78);for(const u of[-1,1])t.beginPath(),t.moveTo(a+u*i*.06,o+i*.12),t.lineTo(a+u*i*.06,o+i*.19),t.stroke();for(const u of[-1,1]){const f=a+u*i*.3,c=o-i*.08;t.fillStyle="#1d100b",t.beginPath(),t.arc(f,c,i*.085,0,Math.PI*2),t.fill(),t.fillStyle="rgba(255, 250, 243, 0.9)",t.beginPath(),t.arc(f-u*i*.018,c-i*.024,i*.024,0,Math.PI*2),t.fill()}t.strokeStyle="rgba(39, 23, 14, 0.62)",t.lineWidth=Math.max(1,d*.62);for(const u of[-1,1]){const f=a+u*i*.3,c=o+i*.24;for(const y of[-.08,0,.08])t.beginPath(),t.moveTo(f,c+i*y),t.lineTo(f+u*i*.56,c+i*y-i*.06),t.stroke()}t.fillStyle="#fff2df";const h=i*.1,m=i*.22,M=o+i*.35;t.fillRect(a-h-i*.02,M,h,m),t.fillRect(a+i*.02,M,h,m),t.strokeStyle="#3a2017",t.lineWidth=Math.max(1,d*.8),t.beginPath(),t.arc(a,o+i*.39,i*.22,.2,Math.PI-.2),t.stroke();for(const u of[-1,1]){const f=a+u*i*.5,c=o+i*.5;t.fillStyle="#7b4a2e",t.beginPath(),t.ellipse(f,c,i*.22,i*.14,0,0,Math.PI*2),t.fill(),t.strokeStyle="#d8bea6",t.lineWidth=Math.max(1,d*.52);for(const y of[-.07,0,.07])t.beginPath(),t.moveTo(f+i*y,c+i*.03),t.lineTo(f+i*y,c+i*.11),t.stroke()}t.restore()}function rt(t,e){const n=e.center.y+e.radius*.22,s=e.radius*1.08,i=e.radius*.55,r=t.createLinearGradient(0,n-i,0,n+i);r.addColorStop(0,"rgba(183, 129, 80, 0.12)"),r.addColorStop(.46,"rgba(110, 66, 36, 0.34)"),r.addColorStop(1,"rgba(59, 32, 16, 0.56)"),t.fillStyle=r,t.beginPath(),t.ellipse(e.center.x,n,s,i,0,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(31, 16, 8, 0.62)",t.lineWidth=Math.max(2,e.radius*.08),t.beginPath(),t.ellipse(e.center.x,n+e.radius*.02,s*.97,i*.89,0,0,Math.PI*2),t.stroke()}function at(t,e,n,s){s.status!=="running"&&(t.fillStyle="rgba(17, 21, 15, 0.38)",t.fillRect(0,0,e,n),t.textAlign="center",t.textBaseline="middle",t.fillStyle="#fff8dd",s.status==="idle"?(t.font="700 38px Impact, Haettenschweiler, sans-serif",t.fillText("Whack-a-Mole",e/2,n/2-14),t.font="700 22px 'Trebuchet MS', 'Gill Sans', sans-serif",t.fillText("Press Start",e/2,n/2+24)):(t.font="700 36px Impact, Haettenschweiler, sans-serif",t.fillText("Time's Up!",e/2,n/2-26),t.font="700 21px 'Trebuchet MS', 'Gill Sans', sans-serif",t.fillText(`Final Score: ${s.score}`,e/2,n/2+8),t.fillText("Press Restart to play again",e/2,n/2+40)),t.textAlign="left",t.textBaseline="alphabetic")}function ot(t,e,n,s,i,r){et(t,e,n),it(t,e,s);const a=new Map(s.activeMoles.map(o=>[o.holeId,o]));for(const o of i)nt(t,o);for(const o of i){const d=a.get(o.id);d&&st(t,o,d,r)}for(const o of i)rt(t,o);at(t,e,n,s)}function lt(t){return t>=4e4?3:t>=2e4?2:1}function w(t,e){const n=Math.max(0,Math.floor(t/e.difficultyStepMs)),s=Math.max(e.minVisibleDurationMs,e.baseVisibleDurationMs-n*e.visibleDurationStepMs),i=Math.max(e.minSpawnDelayMinMs,e.baseSpawnDelayMinMs-n*e.spawnDelayMinStepMs),r=Math.max(e.minSpawnDelayMaxMs,e.baseSpawnDelayMaxMs-n*e.spawnDelayMaxStepMs),a=Math.max(i,r);return{level:n,maxConcurrentMoles:lt(t),visibleDurationMs:s,spawnDelayMinMs:i,spawnDelayMaxMs:a}}function I(t,e){return{status:"idle",score:0,bestScore:t,timeLeftMs:e.roundDurationMs,roundStartMs:null,nextSpawnAtMs:0,activeMoles:[],difficulty:w(0,e)}}function ut(t,e,n){if(t===null)return n;const s=Math.max(0,e-t);return Math.max(0,n-s)}function dt(t,e,n){return t.map(i=>i.state==="up"&&e>=i.hideAtMs?{...i,state:"hiding",hideStartedAtMs:i.hideAtMs,hideDurationMs:n.timeoutHideDurationMs,hideReason:"timeout"}:i).filter(i=>{if(i.state!=="hiding")return!0;const r=i.hideStartedAtMs??e;return e<r+i.hideDurationMs})}function ft(t,e,n,s){const i=t.findIndex(d=>d.id===e);if(i<0)return{activeMoles:t,awardedPoint:!1};const r=t[i];if(r.wasHit)return{activeMoles:t,awardedPoint:!1};let a;r.state==="hiding"?a={...r,wasHit:!0,hideReason:"hit"}:a={...r,wasHit:!0,state:"hiding",hideStartedAtMs:n,hideDurationMs:s.hitHideDurationMs,hideReason:"hit"};const o=[...t];return o[i]=a,{activeMoles:o,awardedPoint:!0}}function ct(t,e){const n=new Set(e.map(i=>i.holeId)),s=[];for(let i=0;i<t;i+=1)n.has(i)||s.push(i);return s}function ht(t,e,n){const s=Math.floor(n()*1e6).toString(36).padStart(4,"0");return`${t.toFixed(0)}-${e}-${s}`}function Mt(t,e,n,s=Math.random){if(t.activeMoles.length>=t.difficulty.maxConcurrentMoles)return t;const i=n.boardRows*n.boardCols,r=ct(i,t.activeMoles);if(r.length===0)return t;const a=A(0,r.length-1,s),o=r[a],d={id:ht(e,o,s),holeId:o,shownAtMs:e,hideAtMs:e+t.difficulty.visibleDurationMs,state:"up",hideStartedAtMs:null,hideDurationMs:n.timeoutHideDurationMs,hideReason:null,wasHit:!1};return{...t,activeMoles:[...t.activeMoles,d]}}const R="whackamole.bestScore";function L(t){return typeof window<"u"&&window.localStorage?window.localStorage:null}function pt(t){const e=L();if(!e)return 0;const n=e.getItem(R),s=Number.parseInt(n??"",10);return Number.isFinite(s)&&s>=0?s:0}function mt(t,e){const n=L();if(!n)return;const s=Math.max(0,Math.floor(t));n.setItem(R,String(s))}class St{constructor(e,n=H,s={}){this.hitSoundPlayer=q(),this.holes=[],this.frameHandle=null,this.frame=r=>{if(this.state.status!=="running"){this.frameHandle=null,this.renderCurrentState(r);return}this.update(r),this.renderCurrentState(r),this.state.status==="running"?this.frameHandle=requestAnimationFrame(this.frame):this.frameHandle=null},this.handlePointerDown=r=>{if(this.state.status!=="running")return;r.preventDefault(),this.hitSoundPlayer.prime();const a=performance.now(),o=K(r,this.canvas),d=Q(o,this.state.activeMoles,this.holes,a);if(!d)return;const p=ft(this.state.activeMoles,d,a,this.config);p.awardedPoint&&(this.state={...this.state,score:this.state.score+1,activeMoles:p.activeMoles,nextSpawnAtMs:0},this.hitSoundPlayer.playHit(),this.emitState(),this.renderCurrentState(a))},this.handleResize=()=>{this.renderCurrentState()};const i=e.getContext("2d");if(!i)throw new Error("2D canvas context is not available.");this.canvas=e,this.context=i,this.config=n,this.onStateChange=s.onStateChange,this.random=s.random??Math.random,this.state=I(pt(),n),this.canvas.addEventListener("pointerdown",this.handlePointerDown),window.addEventListener("resize",this.handleResize),this.renderCurrentState(),this.emitState()}getState(){return{...this.state,activeMoles:[...this.state.activeMoles]}}start(){this.state.status!=="running"&&this.beginRound()}restart(){this.beginRound()}setSoundMuted(e){this.hitSoundPlayer.setMuted(e)}isSoundMuted(){return this.hitSoundPlayer.isMuted()}destroy(){this.stopLoop(),this.hitSoundPlayer.destroy(),this.canvas.removeEventListener("pointerdown",this.handlePointerDown),window.removeEventListener("resize",this.handleResize)}beginRound(){const e=performance.now();this.state={...I(this.state.bestScore,this.config),status:"running",roundStartMs:e,timeLeftMs:this.config.roundDurationMs,difficulty:w(0,this.config),nextSpawnAtMs:0},this.emitState(),this.renderCurrentState(e),this.startLoop()}startLoop(){this.frameHandle===null&&(this.frameHandle=requestAnimationFrame(this.frame))}stopLoop(){this.frameHandle!==null&&(cancelAnimationFrame(this.frameHandle),this.frameHandle=null)}update(e){if(this.state.roundStartMs===null)return;const n=Math.max(0,e-this.state.roundStartMs),s=w(n,this.config),i=ut(this.state.roundStartMs,e,this.config.roundDurationMs);if(this.state={...this.state,difficulty:s,timeLeftMs:i,activeMoles:dt(this.state.activeMoles,e,this.config)},i<=0){this.finishRound();return}this.state=this.reconcileSpawning(this.state,e)}reconcileSpawning(e,n){const s=e.difficulty.maxConcurrentMoles;return e.activeMoles.length>=s?e.nextSpawnAtMs!==0?{...e,nextSpawnAtMs:0}:e:e.nextSpawnAtMs<=0?{...e,nextSpawnAtMs:n+Z(e.difficulty,this.random)}:n<e.nextSpawnAtMs?e:{...Mt(e,n,this.config,this.random),nextSpawnAtMs:0}}finishRound(){let e=this.state.bestScore;this.state.score>e&&(e=this.state.score,mt(e)),this.state={...this.state,status:"gameOver",roundStartMs:null,timeLeftMs:0,nextSpawnAtMs:0,activeMoles:[],bestScore:e},this.emitState(),this.stopLoop()}renderCurrentState(e=performance.now()){const n=x(this.canvas,this.context);this.holes=tt(n.width,n.height,this.config.boardRows,this.config.boardCols),ot(this.context,n.width,n.height,this.state,this.holes,e)}emitState(){this.onStateChange&&this.onStateChange(this.getState())}}const E=document.querySelector("#game-canvas"),P=document.querySelector("#start-btn"),v=document.querySelector("#restart-btn"),_=document.querySelector("#mute-btn"),T=document.querySelector("#status");if(!E||!P||!v||!_||!T)throw new Error("Required game elements are missing from index.html.");const b=_;function O(t){return t.status==="idle"?"Press Start to begin. Whack as many moles as possible in 60 seconds.":t.status==="running"?"Game in progress. Tap or click visible moles to score points.":`Time's up. Final score: ${t.score}. Best score: ${t.bestScore}.`}const g=new St(E,H,{onStateChange:t=>{P.disabled=t.status==="running",v.disabled=t.status==="idle",T.textContent=O(t)}});P.addEventListener("click",()=>{g.start()});v.addEventListener("click",()=>{g.restart()});function B(){const t=g.isSoundMuted();b.textContent=t?"Unmute Sound":"Mute Sound",b.setAttribute("aria-pressed",String(t)),b.classList.toggle("is-muted",t)}b.addEventListener("click",()=>{g.setSoundMuted(!g.isSoundMuted()),B()});T.textContent=O(g.getState());B();window.addEventListener("beforeunload",()=>{g.destroy()});
