(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const p=10,O=20,y=2,m=O+y,W=1,se=10,oe=1,ne=1,ce=2,ae={1:100,2:300,3:500,4:800},le=["I","O","T","S","Z","J","L"],x={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],O:[[1,1],[1,1]],T:[[0,1,0],[1,1,1],[0,0,0]],S:[[0,1,1],[1,1,0],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]]};function fe(e){const t=e.length,r=Array.from({length:t},()=>Array(t).fill(0));for(let i=0;i<t;i+=1)for(let s=0;s<t;s+=1)r[s][t-1-i]=e[i][s];return r}function he(e){const t=[];for(let r=0;r<e.length;r+=1)for(let i=0;i<e.length;i+=1)e[r][i]===1&&t.push([i,r]);return t}function S(e){const t=[];let r=e;for(let i=0;i<4;i+=1)t.push(he(r)),r=fe(r);return t}const ue={I:4,O:2,T:3,S:3,Z:3,J:3,L:3},E={I:S(x.I),O:S(x.O),T:S(x.T),S:S(x.S),Z:S(x.Z),J:S(x.J),L:S(x.L)},de={"0>1":[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],"1>0":[[0,0],[1,0],[1,-1],[0,2],[1,2]],"1>2":[[0,0],[1,0],[1,-1],[0,2],[1,2]],"2>1":[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],"2>3":[[0,0],[1,0],[1,1],[0,-2],[1,-2]],"3>2":[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],"3>0":[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],"0>3":[[0,0],[1,0],[1,1],[0,-2],[1,-2]]},pe={"0>1":[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],"1>0":[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],"1>2":[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],"2>1":[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],"2>3":[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],"3>2":[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],"3>0":[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],"0>3":[[0,0],[-1,0],[2,0],[-1,2],[2,-1]]};function xe(e,t,r){if(e==="O")return[[0,0]];const i=`${t}>${r}`;return e==="I"?pe[i]??[[0,0]]:de[i]??[[0,0]]}const C=[800,720,630,550,470,380,300,220,130,100,80,80,70,70,60];function Se(e){const t=Math.max(0,Math.min(C.length-1,e-1));return C[t]}const T={I:"#48d8ff",O:"#ffd95e",T:"#c886ff",S:"#61f4a6",Z:"#ff7c7c",J:"#7aa2ff",L:"#ffba6b"},ge=1664525,ve=1013904223;function K(e){const t=Math.abs(Math.floor(e))>>>0;return t===0?1:t}function ye(e){return e*ge+ve>>>0}function we(e,t){const r=ye(e);return{value:r%t,seed:r}}function me(e){let t=K(e);const r=[...le];for(let i=r.length-1;i>0;i-=1){const{value:s,seed:o}=we(t,i+1);t=o,[r[i],r[s]]=[r[s],r[i]]}return{bag:r,seed:t}}var n=(e=>(e.MoveLeft="move_left",e.MoveRight="move_right",e.SoftDrop="soft_drop",e.HardDrop="hard_drop",e.RotateCW="rotate_cw",e.RotateCCW="rotate_ccw",e.PauseToggle="pause_toggle",e.Restart="restart",e))(n||{});function Re(){return Array.from({length:m},()=>Array(p).fill(null))}function Pe(e){return e.map(t=>[...t])}function be(e){return{...e,activePiece:{...e.activePiece},nextQueue:[...e.nextQueue],bag:[...e.bag]}}function z(e){if(e.bag.length===0){const t=me(e.rngSeed);e.bag=t.bag,e.rngSeed=t.seed}return e.bag.shift()}function _(e){for(;e.nextQueue.length<oe;)e.nextQueue.push(z(e))}function Q(e){const t=ue[e];return{type:e,rotation:0,x:Math.floor((p-t)/2),y:0}}function U(e){return E[e.type][e.rotation].map(([t,r])=>({x:e.x+t,y:e.y+r}))}function M(e,t){const r=U(t);for(const i of r)if(i.x<0||i.x>=p||i.y>=m||i.y>=0&&e[i.y][i.x]!==null)return!1;return!0}function X(e=Date.now()){const t={board:Re(),activePiece:{type:"I",rotation:0,x:0,y:0},nextQueue:[],bag:[],rngSeed:K(e),score:0,level:W,lines:0,isPaused:!1,isGameOver:!1,gravityTimerMs:0},r=z(t);return t.activePiece=Q(r),_(t),M(t.board,t.activePiece)||(t.isGameOver=!0),t}function Me(e=Date.now()){return X(e)}function w(e,t,r){const i={...e.activePiece,x:e.activePiece.x+t,y:e.activePiece.y+r};return M(e.board,i)?(e.activePiece=i,!0):!1}function I(e,t){const r=e.activePiece.rotation,i=(r+(t?1:3))%4,s=xe(e.activePiece.type,r,i);for(const[o,l]of s){const a={...e.activePiece,rotation:i,x:e.activePiece.x+o,y:e.activePiece.y+l};if(M(e.board,a)){e.activePiece=a;return}}}function Te(e){const t=[];let r=0;for(const s of e)s.every(o=>o!==null)?r+=1:t.push([...s]);return{board:[...Array.from({length:r},()=>Array(p).fill(null)),...t],clearedLines:r}}function Le(e){_(e);const t=e.nextQueue.shift();if(t===void 0){e.isGameOver=!0;return}_(e),e.activePiece=Q(t),M(e.board,e.activePiece)||(e.isGameOver=!0)}function F(e){const t=Pe(e.board);let r=!1;for(const o of U(e.activePiece)){if(o.y<0){r=!0;continue}if(o.y>=m||o.x<0||o.x>=p){r=!0;continue}t[o.y][o.x]=e.activePiece.type}const{board:i,clearedLines:s}=Te(t);if(e.board=i,s>0){const o=ae[s]??0;e.score+=o*e.level,e.lines+=s,e.level=W+Math.floor(e.lines/se)}return e.gravityTimerMs=0,r?(e.isGameOver=!0,e):(Le(e),e)}function Ee(e,t){if(t<=0||e.isGameOver)return e;const r=Se(e.level);for(e.gravityTimerMs+=t;e.gravityTimerMs>=r&&!e.isGameOver;)if(e.gravityTimerMs-=r,!w(e,0,1)){F(e);break}return e}function _e(e){let t=0;for(;w(e,0,1);)t+=1;return e.score+=t*ce,F(e)}function Oe(e,t){switch(t){case n.MoveLeft:w(e,-1,0);break;case n.MoveRight:w(e,1,0);break;case n.SoftDrop:w(e,0,1)&&(e.score+=ne);break;case n.RotateCW:I(e,!0);break;case n.RotateCCW:I(e,!1);break}return e}function De(e,t,r){if(r.includes(n.Restart))return Me(e.rngSeed+1>>>0);const i=be(e);if(r.includes(n.PauseToggle)&&!i.isGameOver&&(i.isPaused=!i.isPaused),i.isPaused||i.isGameOver)return i;let s=!1;for(const o of r)if(!(o===n.PauseToggle||o===n.Restart)){if(o===n.HardDrop){_e(i),s=!0;break}if(Oe(i,o),i.isGameOver)return i}return s||Ee(i,t),i}const k=160,G=45,N=45;class Ae{constructor(t=window){this.target=t,this.immediateQueue=[],this.leftState={pressed:!1,delayMs:0,repeatMs:0},this.rightState={pressed:!1,delayMs:0,repeatMs:0},this.downState={pressed:!1,repeatMs:0},this.handleKeyDown=r=>{const i=H(r.code);if(i!==null){switch(i){case n.MoveLeft:this.pressHorizontal(this.leftState,i);break;case n.MoveRight:this.pressHorizontal(this.rightState,i);break;case n.SoftDrop:this.pressSoftDrop();break;default:r.repeat||this.immediateQueue.push(i);break}r.preventDefault()}},this.handleKeyUp=r=>{const i=H(r.code);if(i!==null){switch(i){case n.MoveLeft:this.resetHorizontal(this.leftState);break;case n.MoveRight:this.resetHorizontal(this.rightState);break;case n.SoftDrop:this.downState.pressed=!1,this.downState.repeatMs=0;break}r.preventDefault()}},this.handleBlur=()=>{this.resetHorizontal(this.leftState),this.resetHorizontal(this.rightState),this.downState.pressed=!1,this.downState.repeatMs=0},this.target.addEventListener("keydown",this.handleKeyDown),this.target.addEventListener("keyup",this.handleKeyUp),this.target.addEventListener("blur",this.handleBlur)}dispose(){this.target.removeEventListener("keydown",this.handleKeyDown),this.target.removeEventListener("keyup",this.handleKeyUp),this.target.removeEventListener("blur",this.handleBlur)}pollActions(t){const r=this.immediateQueue;return this.immediateQueue=[],this.pushHorizontalRepeats(r,this.leftState,this.rightState.pressed,n.MoveLeft,t),this.pushHorizontalRepeats(r,this.rightState,this.leftState.pressed,n.MoveRight,t),this.pushSoftDropRepeats(r,t),r}pressHorizontal(t,r){t.pressed||(t.pressed=!0,t.delayMs=0,t.repeatMs=0,this.immediateQueue.push(r))}resetHorizontal(t){t.pressed=!1,t.delayMs=0,t.repeatMs=0}pressSoftDrop(){this.downState.pressed||(this.downState.pressed=!0,this.downState.repeatMs=0,this.immediateQueue.push(n.SoftDrop))}pushHorizontalRepeats(t,r,i,s,o){if(!(!r.pressed||i)){if(r.delayMs<k){r.delayMs+=o,r.delayMs>=k&&(t.push(s),r.repeatMs=0);return}for(r.repeatMs+=o;r.repeatMs>=G;)r.repeatMs-=G,t.push(s)}}pushSoftDropRepeats(t,r){if(this.downState.pressed)for(this.downState.repeatMs+=r;this.downState.repeatMs>=N;)this.downState.repeatMs-=N,t.push(n.SoftDrop)}}function H(e){switch(e){case"ArrowLeft":return n.MoveLeft;case"ArrowRight":return n.MoveRight;case"ArrowDown":return n.SoftDrop;case"ArrowUp":case"KeyX":return n.RotateCW;case"KeyZ":return n.RotateCCW;case"Space":return n.HardDrop;case"KeyP":return n.PauseToggle;case"KeyR":return n.Restart;default:return null}}const u=28,d=24,c=20,g=p*u,f=O*u,h=d+g+26,P=150,R=h+P+20,L=c+f+20,Ce="#0b1623",Ie="#10273a";class ke{constructor(t){this.canvas=t;const r=this.canvas.getContext("2d");if(r===null)throw new Error("CanvasRenderingContext2D is unavailable.");this.ctx=r,this.canvas.width=R,this.canvas.height=L}render(t){this.drawBackground(),this.drawBoardFrame(),this.drawPlacedCells(t.board),this.drawActivePiece(t.activePiece),this.drawPanel(t),t.isPaused&&this.drawOverlay("PAUSED"),t.isGameOver&&this.drawOverlay("GAME OVER")}drawBackground(){const t=this.ctx.createLinearGradient(0,0,R,L);t.addColorStop(0,Ce),t.addColorStop(1,Ie),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,R,L),this.ctx.fillStyle="rgba(168, 210, 255, 0.08)",this.ctx.beginPath(),this.ctx.arc(78,72,54,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(R-92,96,66,0,Math.PI*2),this.ctx.fill()}drawBoardFrame(){this.ctx.fillStyle="rgba(7, 20, 31, 0.85)",this.ctx.fillRect(d-4,c-4,g+8,f+8),this.ctx.strokeStyle="rgba(188, 224, 255, 0.55)",this.ctx.lineWidth=2,this.ctx.strokeRect(d-4,c-4,g+8,f+8),this.ctx.strokeStyle="rgba(95, 137, 176, 0.24)",this.ctx.lineWidth=1;for(let t=0;t<=p;t+=1){const r=d+t*u;this.ctx.beginPath(),this.ctx.moveTo(r,c),this.ctx.lineTo(r,c+f),this.ctx.stroke()}for(let t=0;t<=O;t+=1){const r=c+t*u;this.ctx.beginPath(),this.ctx.moveTo(d,r),this.ctx.lineTo(d+g,r),this.ctx.stroke()}}drawPlacedCells(t){for(let r=y;r<m;r+=1)for(let i=0;i<p;i+=1){const s=t[r][i];s!==null&&this.drawBoardCell(i,r-y,T[s])}}drawActivePiece(t){const r=E[t.type][t.rotation],i=T[t.type];for(const[s,o]of r){const l=t.x+s,a=t.y+o;a<y||a>=m||this.drawBoardCell(l,a-y,i)}}drawBoardCell(t,r,i){const s=d+t*u,o=c+r*u;this.ctx.fillStyle=i,this.ctx.fillRect(s+1,o+1,u-2,u-2),this.ctx.strokeStyle="rgba(0, 12, 24, 0.55)",this.ctx.lineWidth=1,this.ctx.strokeRect(s+1,o+1,u-2,u-2),this.ctx.fillStyle="rgba(255, 255, 255, 0.16)",this.ctx.fillRect(s+2,o+2,u-8,6)}drawPanel(t){this.ctx.fillStyle="rgba(4, 17, 27, 0.8)",this.ctx.fillRect(h,c,P,f),this.ctx.strokeStyle="rgba(188, 224, 255, 0.45)",this.ctx.lineWidth=1,this.ctx.strokeRect(h,c,P,f),this.ctx.fillStyle="#e9f3ff",this.ctx.font='600 17px "Trebuchet MS", "Gill Sans", sans-serif',this.ctx.fillText("Next",h+14,c+28),this.drawNextPiece(t.nextQueue[0]??null),this.ctx.font='600 15px "Trebuchet MS", "Gill Sans", sans-serif',this.ctx.fillText(`Score: ${t.score}`,h+14,c+172),this.ctx.fillText(`Level: ${t.level}`,h+14,c+202),this.ctx.fillText(`Lines: ${t.lines}`,h+14,c+232),this.ctx.font='500 13px "Trebuchet MS", "Gill Sans", sans-serif',this.ctx.fillStyle="rgba(229, 241, 255, 0.85)",this.ctx.fillText("P: Pause",h+14,c+f-72),this.ctx.fillText("R: Restart",h+14,c+f-52),this.ctx.fillText("Space: Hard Drop",h+14,c+f-32)}drawNextPiece(t){const r=h+14,i=c+40,s=P-28,o=108;if(this.ctx.fillStyle="rgba(7, 22, 35, 0.9)",this.ctx.fillRect(r,i,s,o),this.ctx.strokeStyle="rgba(148, 192, 231, 0.3)",this.ctx.strokeRect(r,i,s,o),t===null)return;const l=E[t][0],a=20,$=Math.max(...l.map(([v])=>v)),q=Math.max(...l.map(([,v])=>v)),j=($+1)*a,ee=(q+1)*a,te=r+(s-j)/2,re=i+(o-ee)/2;this.ctx.fillStyle=T[t];for(const[v,ie]of l){const D=te+v*a,A=re+ie*a;this.ctx.fillRect(D+1,A+1,a-2,a-2),this.ctx.strokeStyle="rgba(0, 15, 30, 0.62)",this.ctx.strokeRect(D+1,A+1,a-2,a-2)}}drawOverlay(t){this.ctx.fillStyle="rgba(4, 10, 16, 0.68)",this.ctx.fillRect(d,c,g,f),this.ctx.fillStyle="#f4f8ff",this.ctx.textAlign="center",this.ctx.font='700 30px "Trebuchet MS", "Gill Sans", sans-serif',this.ctx.fillText(t,d+g/2,c+f/2),this.ctx.textAlign="start"}}const Y=document.querySelector("#game-canvas");if(Y===null)throw new Error("Expected a #game-canvas element in index.html.");const Z=new ke(Y),V=new Ae(window);let b=X(),B=performance.now();Z.render(b);function J(e){const t=Math.min(100,e-B);B=e;const r=V.pollActions(t);b=De(b,t,r),Z.render(b),window.requestAnimationFrame(J)}window.requestAnimationFrame(J);window.addEventListener("beforeunload",()=>{V.dispose()});
