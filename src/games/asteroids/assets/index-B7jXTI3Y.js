var w=Object.defineProperty;var S=(s,t,i)=>t in s?w(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var o=(s,t,i)=>S(s,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&e(h)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const b=new Set(["ArrowLeft","ArrowRight","ArrowUp","Space"]);class R{constructor(t){o(this,"heldKeys",new Set);o(this,"onKeyDown",t=>{b.has(t.code)&&(this.heldKeys.add(t.code),t.code==="Space"&&t.preventDefault())});o(this,"onKeyUp",t=>{this.heldKeys.delete(t.code)});o(this,"onBlur",()=>{this.heldKeys.clear()});this.target=t,this.target.addEventListener("keydown",this.onKeyDown),this.target.addEventListener("keyup",this.onKeyUp),this.target.addEventListener("blur",this.onBlur)}isDown(t){return this.heldKeys.has(t)}destroy(){this.target.removeEventListener("keydown",this.onKeyDown),this.target.removeEventListener("keyup",this.onKeyUp),this.target.removeEventListener("blur",this.onBlur),this.heldKeys.clear()}}const g=Math.PI*2;function p(s){return{x:Math.cos(s),y:Math.sin(s)}}function f(s,t){const i=s.x-t.x,e=s.y-t.y;return i*i+e*e}function l(s,t){return s+Math.random()*(t-s)}function y(){const s=l(0,g);return p(s)}function m(s,t,i){s.x<0?s.x+=t:s.x>=t&&(s.x-=t),s.y<0?s.y+=i:s.y>=i&&(s.y-=i)}function A(s,t){const i=Math.hypot(s.x,s.y);if(i>t&&i>0){const e=t/i;s.x*=e,s.y*=e}}class c{constructor(t,i,e,n,r,h,a){o(this,"size");o(this,"position");o(this,"velocity");o(this,"radius");o(this,"points");o(this,"angle");o(this,"spin");this.size=t,this.position=i,this.velocity=e,this.radius=n,this.points=r,this.angle=h,this.spin=a}static create(t,i,e,n){const r=c.generatePoints(t,n);return new c(t,{...i},{...e},n,r,l(0,g),l(-.8,.8))}update(t,i,e){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.angle+=this.spin*t,m(this.position,i,e)}draw(t){t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle),t.lineWidth=2,t.strokeStyle="#b7c7dd",t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(let i=1;i<this.points.length;i+=1)t.lineTo(this.points[i].x,this.points[i].y);t.closePath(),t.stroke(),t.restore()}static generatePoints(t,i){const[e,n]=c.vertexRangeBySize(t),r=Math.floor(l(e,n+1)),h=[];for(let a=0;a<r;a+=1){const d=a/r*g,v=l(.72,1.2);h.push({x:Math.cos(d)*i*v,y:Math.sin(d)*i*v})}return h}static vertexRangeBySize(t){return t==="large"?[11,15]:t==="medium"?[9,12]:[7,10]}}class P{constructor(t,i,e,n){o(this,"position");o(this,"velocity");o(this,"radius");o(this,"lifeRemaining");this.position={...t},this.velocity={...i},this.radius=e,this.lifeRemaining=n}get isAlive(){return this.lifeRemaining>0}update(t,i,e){this.lifeRemaining-=t,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,m(this.position,i,e)}draw(t){t.beginPath(),t.fillStyle="#dce9ff",t.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),t.fill()}}class T{constructor(t,i){o(this,"position");o(this,"velocity");o(this,"radius");o(this,"angle");o(this,"invulnerabilityRemaining",0);this.position={...t},this.velocity={x:0,y:0},this.radius=i,this.angle=-Math.PI/2}get invulnerable(){return this.invulnerabilityRemaining>0}update(t,i,e,n,r){if(i.isDown("ArrowLeft")&&(this.angle-=e.shipTurnSpeed*t),i.isDown("ArrowRight")&&(this.angle+=e.shipTurnSpeed*t),i.isDown("ArrowUp")){const a=p(this.angle);this.velocity.x+=a.x*e.shipThrust*t,this.velocity.y+=a.y*e.shipThrust*t}const h=Math.max(0,1-e.shipDamping*t);this.velocity.x*=h,this.velocity.y*=h,A(this.velocity,e.shipMaxSpeed),this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,m(this.position,n,r),this.invulnerabilityRemaining>0&&(this.invulnerabilityRemaining=Math.max(0,this.invulnerabilityRemaining-t))}reset(t){this.position.x=t.x,this.position.y=t.y,this.velocity.x=0,this.velocity.y=0,this.angle=-Math.PI/2,this.invulnerabilityRemaining=0}respawn(t,i){this.reset(t),this.invulnerabilityRemaining=i}getNosePosition(t=this.radius+2){const i=p(this.angle);return{x:this.position.x+i.x*t,y:this.position.y+i.y*t}}draw(t,i){this.invulnerable&&Math.floor(i*12)%2===0||(t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle),t.lineWidth=2,t.strokeStyle="#f4f8ff",t.beginPath(),t.moveTo(16,0),t.lineTo(-12,10),t.lineTo(-12,-10),t.closePath(),t.stroke(),t.restore())}}const L={large:"medium",medium:"small",small:null},M={fixedTimeStep:1/120,maxFrameTime:.25,shipTurnSpeed:Math.PI*2.8,shipThrust:320,shipDamping:.12,shipMaxSpeed:420,shipRadius:14,shipInvulnerability:2,bulletSpeed:560,bulletRadius:2.4,bulletLifetime:1.2,maxBullets:6,shootCooldown:.12,baseAsteroids:5,asteroidsPerLevel:1,asteroidSpawnSafeRadius:170,asteroidBySize:{large:{radius:52,minSpeed:32,maxSpeed:72,score:20},medium:{radius:32,minSpeed:58,maxSpeed:108,score:50},small:{radius:18,minSpeed:92,maxSpeed:148,score:100}}};class C{constructor(t,i,e=M){o(this,"ctx");o(this,"input");o(this,"ship");o(this,"config");o(this,"bullets",[]);o(this,"asteroids",[]);o(this,"score",0);o(this,"lives",3);o(this,"level",1);o(this,"gameOver",!1);o(this,"accumulator",0);o(this,"previousFrameSeconds",0);o(this,"shootCooldownRemaining",0);o(this,"rafId",null);o(this,"onRestart",()=>{this.resetState()});o(this,"onFrame",t=>{const i=t/1e3;this.previousFrameSeconds===0&&(this.previousFrameSeconds=i);let e=i-this.previousFrameSeconds;for(this.previousFrameSeconds=i,e=Math.min(e,this.config.maxFrameTime),this.accumulator+=e;this.accumulator>=this.config.fixedTimeStep;)this.update(this.config.fixedTimeStep),this.accumulator-=this.config.fixedTimeStep;this.render(i),this.rafId=requestAnimationFrame(this.onFrame)});this.canvas=t,this.hud=i;const n=t.getContext("2d");if(!n)throw new Error("Unable to create 2D rendering context.");this.ctx=n,this.config=e,this.input=new R(window),this.ship=new T(this.getWorldCenter(),this.config.shipRadius),this.hud.restartButton.addEventListener("click",this.onRestart)}start(){this.resetState(),this.rafId=requestAnimationFrame(this.onFrame)}destroy(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.hud.restartButton.removeEventListener("click",this.onRestart),this.input.destroy()}update(t){if(!this.gameOver){this.ship.update(t,this.input,this.config,this.canvas.width,this.canvas.height),this.shootCooldownRemaining=Math.max(0,this.shootCooldownRemaining-t),this.input.isDown("Space")&&this.tryShoot();for(let i=this.bullets.length-1;i>=0;i-=1){const e=this.bullets[i];e.update(t,this.canvas.width,this.canvas.height),e.isAlive||this.bullets.splice(i,1)}for(const i of this.asteroids)i.update(t,this.canvas.width,this.canvas.height);this.resolveBulletAsteroidCollisions(),this.resolveShipAsteroidCollision(),!this.gameOver&&this.asteroids.length===0&&(this.level+=1,this.spawnLevelAsteroids())}this.updateHud()}render(t){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#05070b",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(const i of this.asteroids)i.draw(this.ctx);for(const i of this.bullets)i.draw(this.ctx);this.ship.draw(this.ctx,t),this.gameOver&&this.drawGameOverOverlay()}drawGameOverOverlay(){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.55)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#f5f8ff",this.ctx.textAlign="center",this.ctx.font="bold 54px Trebuchet MS, sans-serif",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-12),this.ctx.font="22px Trebuchet MS, sans-serif",this.ctx.fillText("Press Restart to play again",this.canvas.width/2,this.canvas.height/2+30),this.ctx.restore()}tryShoot(){if(this.shootCooldownRemaining>0||this.bullets.length>=this.config.maxBullets)return;const t=p(this.ship.angle),i=this.ship.getNosePosition(),e={x:this.ship.velocity.x+t.x*this.config.bulletSpeed,y:this.ship.velocity.y+t.y*this.config.bulletSpeed};this.bullets.push(new P(i,e,this.config.bulletRadius,this.config.bulletLifetime)),this.shootCooldownRemaining=this.config.shootCooldown}resolveBulletAsteroidCollisions(){const t=[];for(let i=this.bullets.length-1;i>=0;i-=1){const e=this.bullets[i];let n=!1;for(let r=this.asteroids.length-1;r>=0;r-=1){const h=this.asteroids[r],a=e.radius+h.radius;if(!(f(e.position,h.position)>a*a)){n=!0,this.bullets.splice(i,1),this.asteroids.splice(r,1),this.score+=this.config.asteroidBySize[h.size].score,t.push(...this.splitAsteroid(h));break}}}t.length>0&&this.asteroids.push(...t)}resolveShipAsteroidCollision(){if(!this.ship.invulnerable)for(const t of this.asteroids){const i=this.ship.radius+t.radius;if(f(this.ship.position,t.position)<=i*i){this.handleShipHit();break}}}splitAsteroid(t){const i=L[t.size];if(!i)return[];const e=this.config.asteroidBySize[i],n=[];for(let r=0;r<2;r+=1){const h=y(),a=l(e.minSpeed,e.maxSpeed);n.push(c.create(i,{x:t.position.x+h.x*(e.radius*.4),y:t.position.y+h.y*(e.radius*.4)},{x:t.velocity.x*.35+h.x*a,y:t.velocity.y*.35+h.y*a},e.radius))}return n}handleShipHit(){if(this.lives-=1,this.bullets=[],this.lives<=0){this.lives=0,this.gameOver=!0;return}this.ship.respawn(this.getWorldCenter(),this.config.shipInvulnerability)}resetState(){this.score=0,this.lives=3,this.level=1,this.gameOver=!1,this.accumulator=0,this.previousFrameSeconds=0,this.shootCooldownRemaining=0,this.bullets=[],this.ship.reset(this.getWorldCenter()),this.spawnLevelAsteroids(),this.updateHud()}spawnLevelAsteroids(){this.asteroids=[];const t=this.config.baseAsteroids+(this.level-1)*this.config.asteroidsPerLevel;for(let i=0;i<t;i+=1)this.asteroids.push(this.createLargeAsteroid())}createLargeAsteroid(){const t=this.config.asteroidBySize.large,i=this.config.asteroidSpawnSafeRadius*this.config.asteroidSpawnSafeRadius;let e=this.randomPosition(),n=!1;for(let a=0;a<60;a+=1){const d=this.randomPosition();if(f(d,this.ship.position)>=i){e=d,n=!0;break}}if(!n){const a=y();e={x:(this.ship.position.x+a.x*this.config.asteroidSpawnSafeRadius+this.canvas.width)%this.canvas.width,y:(this.ship.position.y+a.y*this.config.asteroidSpawnSafeRadius+this.canvas.height)%this.canvas.height}}const r=y(),h=l(t.minSpeed,t.maxSpeed);return c.create("large",e,{x:r.x*h,y:r.y*h},t.radius)}randomPosition(){return{x:l(0,this.canvas.width),y:l(0,this.canvas.height)}}getWorldCenter(){return{x:this.canvas.width/2,y:this.canvas.height/2}}updateHud(){this.hud.score.textContent=`${this.score}`,this.hud.lives.textContent=`${this.lives}`,this.hud.level.textContent=`${this.level}`}}function u(s){const t=document.getElementById(s);if(!t)throw new Error(`Missing required element: #${s}`);return t}const I=u("game-canvas"),E={score:u("score"),lives:u("lives"),level:u("level"),restartButton:u("restart")},x=new C(I,E);x.start();window.addEventListener("beforeunload",()=>{x.destroy()});
